const express = require('express');
const sql = require('sqlite3');
const path = require('path');
const buildHTML = require('build-html');

const app = express();
const dbFile = path.resolve('./BLOG');
const db = new sql.Database(dbFile);

const go = () => {
  app.get('/writing/:slug', (req, res) => {
    db.all('SELECT * from posts', (e, d) => {
      const post = d.find(x => x.slug === req.params.slug);
      if (post) {
        const { html } = buildHTML(post);
        res.send(html);
      } else {
        res.send(`post: ${req.params.slug} not found`);
      }
    });
  });

  app.listen(4000, () => {
    console.log('ðŸŽ‰ adamnet available on :4000!');
  });
};

module.exports = go;
